version: "0.29.0"

definitions:
  selector:
    extractor:
      # API Docs: https://developers.activecampaign.com/reference/schema
      field_path: ["{{ parameters['name'] }}"]

  requester:
    # API Docs: https://developers.activecampaign.com/reference/url
    url_base: "https://{{ config['account_username'] }}.api-us1.com/api/3"
    http_method: "GET"
    authenticator:
      type: ApiKeyAuthenticator
      header: "Api-Token"
      api_token: "{{ config['api_key'] }}"

  retriever:
    record_selector:
      $ref: "#/definitions/selector"

    # API Docs: https://developers.activecampaign.com/reference/pagination
    paginator:
      type: DefaultPaginator
      page_size_option:
        inject_into: "request_parameter"
        field_name: "limit"
      pagination_strategy:
        type: "OffsetIncrement"
        page_size: 20
      page_token_option:
        type: RequestOption
        inject_into: "request_parameter"
        field_name: "offset"

    requester:
      $ref: "#/definitions/requester"

  base_stream:
    retriever:
      $ref: "#/definitions/retriever"

  # API Docs: https://developers.activecampaign.com/reference/list-all-campaigns
  campaigns_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "campaigns"
      primary_key: "id"
      path: "/campaigns"

    # API Docs: https://developers.activecampaign.com/reference/list-all-contacts
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          type:
            type: string
          userid:
            type: string
          segmentid:
            type: string
          bounceid:
            type: string
          realcid:
            type: string
          sendid:
            type: string
          threadid:
            type: string
          seriesid:
            type: string
          formid:
            type: string
          basetemplateid:
            type: string
          basemessageid:
            type: string
          addressid:
            type: string
          source:
            type: string
          name:
            type: string
          cdate:
            type: string
          mdate:
            type: string
          sdate:
            type:
              - string
              - "null"
          ldate:
            type:
              - string
              - "null"
          send_amt:
            type: string
          total_amt:
            type: string
          opens:
            type: string
          uniqueopens:
            type: string
          linkclicks:
            type: string
          uniquelinkclicks:
            type: string
          subscriberclicks:
            type: string
          forwards:
            type: string
          uniqueforwards:
            type: string
          hardbounces:
            type: string
          softbounces:
            type: string
          unsubscribes:
            type: string
          unsubreasons:
            type: string
          updates:
            type: string
          socialshares:
            type: string
          replies:
            type: string
          uniquereplies:
            type: string
          status:
            type: string
          public:
            type: string
          mail_transfer:
            type: string
          mail_send:
            type: string
          mail_cleanup:
            type: string
          mailer_log_file:
            type: string
          tracklinks:
            type: string
          tracklinksanalytics:
            type: string
          trackreads:
            type: string
          trackreadsanalytics:
            type: string
          analytics_campaign_name:
            type: string
          tweet:
            type: string
          facebook:
            type: string
          survey:
            type: string
          embed_images:
            type: string
          htmlunsub:
            type: string
          textunsub:
            type: string
          htmlunsubdata:
            type:
              - string
              - "null"
          textunsubdata:
            type:
              - string
              - "null"
          recurring:
            type: string
          willrecur:
            type: string
          split_type:
            type: string
          split_content:
            type: string
          split_offset:
            type: string
          split_offset_type:
            type: string
          split_winner_messageid:
            type: string
          split_winner_awaiting:
            type: string
          responder_offset:
            type: string
          responder_type:
            type: string
          responder_existing:
            type: string
          reminder_field:
            type: string
          reminder_format:
            type:
              - string
              - "null"
          reminder_type:
            type: string
          reminder_offset:
            type: string
          reminder_offset_type:
            type: string
          reminder_offset_sign:
            type: string
          reminder_last_cron_run:
            type:
              - string
              - "null"
          activerss_interval:
            type: string
          activerss_url:
            type:
              - string
              - "null"
          activerss_items:
            type: string
          ip4:
            type: string
          laststep:
            type: string
          managetext:
            type: string
          schedule:
            type: string
          scheduleddate:
            type:
              - string
              - "null"
          waitpreview:
            type:
              - string
              - "null"
          deletestamp:
            type:
              - string
              - "null"
          replysys:
            type: string
          links:
            type: object
            properties:
              user:
                type: string
              automation:
                type: string
              campaignMessage:
                type: string
              campaignMessages:
                type: string
              links:
                type: string
              campaignLists:
                type: string
            required:
              - user
              - automation
              - campaignMessage
              - campaignMessages
              - links
              - campaignLists
          id:
            type: string
          user:
            type: string
          automation:
            type:
              - string
              - "null"
        required:
          - type
          - userid
          - segmentid
          - bounceid
          - realcid
          - sendid
          - threadid
          - seriesid
          - formid
          - basetemplateid
          - basemessageid
          - addressid
          - source
          - name
          - cdate
          - mdate
          - sdate
          - ldate
          - send_amt
          - total_amt
          - opens
          - uniqueopens
          - linkclicks
          - uniquelinkclicks
          - subscriberclicks
          - forwards
          - uniqueforwards
          - hardbounces
          - softbounces
          - unsubscribes
          - unsubreasons
          - updates
          - socialshares
          - replies
          - uniquereplies
          - status
          - public
          - mail_transfer
          - mail_send
          - mail_cleanup
          - mailer_log_file
          - tracklinks
          - tracklinksanalytics
          - trackreads
          - trackreadsanalytics
          - analytics_campaign_name
          - tweet
          - facebook
          - survey
          - embed_images
          - htmlunsub
          - textunsub
          - htmlunsubdata
          - textunsubdata
          - recurring
          - willrecur
          - split_type
          - split_content
          - split_offset
          - split_offset_type
          - split_winner_messageid
          - split_winner_awaiting
          - responder_offset
          - responder_type
          - responder_existing
          - reminder_field
          - reminder_format
          - reminder_type
          - reminder_offset
          - reminder_offset_type
          - reminder_offset_sign
          - reminder_last_cron_run
          - activerss_interval
          - activerss_url
          - activerss_items
          - ip4
          - laststep
          - managetext
          - schedule
          - scheduleddate
          - waitpreview
          - deletestamp
          - replysys
          - links
          - id
          - user
          - automation
  contacts_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "contacts"
      primary_key: "id"
      path: "/contacts"

    # API Docs: https://developers.activecampaign.com/reference/list-all-deals
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          cdate:
            type: string
          email:
            type: string
          phone:
            type: string
          firstName:
            type: string
          lastName:
            type: string
          orgid:
            type: string
          orgname:
            type: string
          segmentio_id:
            type: string
          bounced_hard:
            type: string
          bounced_soft:
            type: string
          bounced_date:
            type:
              - string
              - "null"
          ip:
            type: string
          ua:
            type:
              - string
              - "null"
          hash:
            type: string
          socialdata_lastcheck:
            type:
              - string
              - "null"
          email_local:
            type: string
          email_domain:
            type: string
          sentcnt:
            type: string
          rating_tstamp:
            type:
              - string
              - "null"
          gravatar:
            type: string
          deleted:
            type: string
          anonymized:
            type: string
          adate:
            type:
              - string
              - "null"
          udate:
            type: string
          edate:
            type:
              - string
              - "null"
          deleted_at:
            type:
              - string
              - "null"
          created_utc_timestamp:
            type: string
          updated_utc_timestamp:
            type: string
          created_timestamp:
            type: string
          updated_timestamp:
            type: string
          created_by:
            type:
              - string
              - "null"
          updated_by:
            type:
              - string
              - "null"
          email_empty:
            type: boolean
          mpp_tracking:
            type: string
          scoreValues:
            type: array
            items:
              type: string
          accountContacts:
            type: array
            items:
              type: string
          links:
            type: object
            properties:
              bounceLogs:
                type: string
              contactAutomations:
                type: string
              contactData:
                type: string
              contactGoals:
                type: string
              contactLists:
                type: string
              contactLogs:
                type: string
              contactTags:
                type: string
              contactDeals:
                type: string
              deals:
                type: string
              fieldValues:
                type: string
              geoIps:
                type: string
              notes:
                type: string
              organization:
                type: string
              plusAppend:
                type: string
              trackingLogs:
                type: string
              scoreValues:
                type: string
              accountContacts:
                type: string
              automationEntryCounts:
                type: string
            required:
              - bounceLogs
              - contactAutomations
              - contactData
              - contactGoals
              - contactLists
              - contactLogs
              - contactTags
              - contactDeals
              - deals
              - fieldValues
              - geoIps
              - notes
              - organization
              - plusAppend
              - trackingLogs
              - scoreValues
              - accountContacts
              - automationEntryCounts
          id:
            type: string
          organization:
            type: "null"
        required:
          - cdate
          - email
          - phone
          - firstName
          - lastName
          - orgid
          - orgname
          - segmentio_id
          - bounced_hard
          - bounced_soft
          - bounced_date
          - ip
          - ua
          - hash
          - socialdata_lastcheck
          - email_local
          - email_domain
          - sentcnt
          - rating_tstamp
          - gravatar
          - deleted
          - anonymized
          - adate
          - udate
          - edate
          - deleted_at
          - created_utc_timestamp
          - updated_utc_timestamp
          - created_timestamp
          - updated_timestamp
          - created_by
          - updated_by
          - email_empty
          - mpp_tracking
          - scoreValues
          - accountContacts
          - links
          - id
          - organization
  deals_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "deals"
      primary_key: "id"
      path: "/deals"

    # API Docs: https://developers.activecampaign.com/reference/retrieve-all-lists
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          owner:
            type:
              - string
              - "null"
          contact:
            type:
              - string
              - "null"
          organization:
            type:
              - string
              - "null"
          group:
            type:
              - string
              - "null"
          stage:
            type:
              - string
              - "null"
          title:
            type:
              - string
              - "null"
          description:
            type:
              - string
              - "null"
          percent:
            type:
              - string
              - "null"
          cdate:
            type:
              - string
              - "null"
          mdate:
            type:
              - string
              - "null"
          nextdate:
            type:
              - string
              - "null"
          nexttaskid:
            type:
              - string
              - "null"
          nextTask:
            type:
              - string
              - "null"
          value:
            type:
              - string
              - "null"
          currency:
            type:
              - string
              - "null"
          winProbability:
            type:
              - integer
              - "null"
          winProbabilityMdate:
            type:
              - string
              - "null"
          status:
            type:
              - string
              - "null"
          activitycount:
            type:
              - string
              - "null"
          nextdealid:
            type:
              - string
              - "null"
          edate:
            type:
              - string
              - "null"
          links:
            type: object
            properties:
              dealActivities:
                type:
                  - string
                  - "null"
              contact:
                type:
                  - string
                  - "null"
              contactDeals:
                type:
                  - string
                  - "null"
              group:
                type:
                  - string
                  - "null"
              nextTask:
                type:
                  - string
                  - "null"
              notes:
                type:
                  - string
                  - "null"
              account:
                type:
                  - string
                  - "null"
              customerAccount:
                type:
                  - string
                  - "null"
              organization:
                type:
                  - string
                  - "null"
              owner:
                type:
                  - string
                  - "null"
              scoreValues:
                type:
                  - string
                  - "null"
              stage:
                type:
                  - string
                  - "null"
              tasks:
                type:
                  - string
                  - "null"
              dealCustomFieldData:
                type:
                  - string
                  - "null"
          id:
            type: string
          hash:
            type:
              - string
              - "null"
          isDisabled:
            type:
              - boolean
              - "null"
          account:
            type:
              - string
              - "null"
          customerAccount:
            type:
              - string
              - "null"
        required:
          - id
  lists_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "lists"
      primary_key: "id"
      path: "/lists"

    # API Docs: https://developers.activecampaign.com/reference/list-all-segments
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          stringid:
            type:
              - string
              - "null"
          userid:
            type:
              - string
              - "null"
          name:
            type:
              - string
              - "null"
          cdate:
            type:
              - string
              - "null"
          p_use_tracking:
            type:
              - string
              - "null"
          p_use_analytics_read:
            type:
              - string
              - "null"
          p_use_analytics_link:
            type:
              - string
              - "null"
          p_use_twitter:
            type:
              - string
              - "null"
          p_use_facebook:
            type:
              - string
              - "null"
          p_embed_image:
            type:
              - string
              - "null"
          p_use_captcha:
            type:
              - string
              - "null"
          send_last_broadcast:
            type:
              - string
              - "null"
          private:
            type:
              - string
              - "null"
          analytics_domains:
            type:
              - string
              - "null"
          analytics_source:
            type:
              - string
              - "null"
          analytics_ua:
            type:
              - string
              - "null"
          twitter_token:
            type:
              - string
              - "null"
          twitter_token_secret:
            type:
              - string
              - "null"
          facebook_session:
            type:
              - string
              - "null"
          carboncopy:
            type:
              - string
              - "null"
          subscription_notify:
            type:
              - string
              - "null"
          unsubscription_notify:
            type:
              - string
              - "null"
          require_name:
            type:
              - string
              - "null"
          get_unsubscribe_reason:
            type:
              - string
              - "null"
          to_name:
            type:
              - string
              - "null"
          optinoptout:
            type:
              - string
              - "null"
          sender_name:
            type:
              - string
              - "null"
          sender_addr1:
            type:
              - string
              - "null"
          sender_addr2:
            type:
              - string
              - "null"
          sender_city:
            type:
              - string
              - "null"
          sender_state:
            type:
              - string
              - "null"
          sender_zip:
            type:
              - string
              - "null"
          sender_country:
            type:
              - string
              - "null"
          sender_phone:
            type:
              - string
              - "null"
          sender_url:
            type:
              - string
              - "null"
          sender_reminder:
            type:
              - string
              - "null"
          fulladdress:
            type:
              - string
              - "null"
          optinmessageid:
            type:
              - string
              - "null"
          optoutconf:
            type:
              - string
              - "null"
          deletestamp:
            type:
              - string
              - "null"
          udate:
            type:
              - string
              - "null"
          links:
            type: object
            properties:
              contactGoalLists:
                type:
                  - string
                  - "null"
              user:
                type:
                  - string
                  - "null"
              addressLists:
                type:
                  - string
                  - "null"
          id:
            type: string
          user:
            type:
              - string
              - "null"
        required:
          - id
  segments_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "segments"
      primary_key: "id"
      path: "/segments"

    # API Docs: https://developers.activecampaign.com/reference/forms-1
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          name:
            type:
              - string
              - "null"
            examples:
              - Segment of Automation 1
          logic:
            type:
              - string
              - "null"
            examples:
              - and
          hidden:
            type:
              - string
              - "null"
            examples:
              - "0"
          seriesid:
            type:
              - string
              - "null"
            examples:
              - "1"
          links:
            type:
              - array
              - "null"
          id:
            type: string
            examples:
              - "1"
        required:
          - id
  forms_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "forms"
      primary_key: "id"
      path: "/forms"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        $id: root
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        properties:
          name:
            type:
              - string
              - "null"
            examples:
              - Testing
          action:
            type:
              - string
              - "null"
          actiondata:
            type: object
            properties:
              actions:
                type: array
                items:
                  type: object
                  properties:
                    type:
                      type:
                        - string
                        - "null"
                      examples:
                        - subscribe-to-list
                    email:
                      type:
                        - string
                        - "null"
                      examples:
                        - johndoe@example.com
                    list:
                      type:
                        - string
                        - "null"
                      examples:
                        - "1"
          submit:
            type:
              - string
              - "null"
            examples:
              - show-thank-you
          submitdata:
            type: object
            properties:
              url:
                type:
                  - string
                  - "null"
          url:
            type:
              - string
              - "null"
          layout:
            type:
              - string
              - "null"
            examples:
              - inline-form
          title:
            type:
              - string
              - "null"
          body:
            type:
              - string
              - "null"
          button:
            type:
              - string
              - "null"
            examples:
              - Submit
          thanks:
            type:
              - string
              - "null"
            examples:
              - Thanks for signing up!
          style:
            type: object
            properties:
              background:
                type:
                  - string
                  - "null"
                examples:
                  - FFFFFF
              dark:
                type:
                  - boolean
                  - "null"
                examples:
                  - true
                  - false
              fontcolor:
                type:
                  - string
                  - "null"
                examples:
                  - "000000"
              layout:
                type:
                  - string
                  - "null"
                examples:
                  - normal
              border:
                type: object
                properties:
                  width:
                    type:
                      - integer
                      - "null"
                    examples:
                      - 0
                  style:
                    type:
                      - string
                      - "null"
                    examples:
                      - solid
                  color:
                    type:
                      - string
                      - "null"
                    examples:
                      - B0B0B0
                  radius:
                    type:
                      - integer
                      - "null"
                    default: 0
                    examples:
                      - 0
              width:
                type:
                  - integer
                  - "null"
                examples:
                  - 500
              ac_branding:
                type:
                  - boolean
                  - "null"
                examples:
                  - true
                  - false
              button:
                type: object
                properties:
                  padding:
                    type:
                      - integer
                      - "null"
                    examples:
                      - 10
                  background:
                    type:
                      - string
                      - "null"
                    examples:
                      - "333333"
                  fontcolor:
                    type:
                      - string
                      - "null"
                    examples:
                      - FFFFFF
                  border:
                    type: object
                    properties:
                      radius:
                        type:
                          - integer
                          - "null"
                        examples:
                          - 4
                      color:
                        type:
                          - string
                          - "null"
                        examples:
                          - "333333"
                      style:
                        type:
                          - string
                          - "null"
                        examples:
                          - solid
                      width:
                        type:
                          - integer
                          - "null"
                        examples:
                          - 0
          options:
            type: object
            properties:
              blanks_overwrite:
                type:
                  - boolean
                  - "null"
                examples:
                  - true
                  - false
              confaction:
                type:
                  - string
                  - "null"
                examples:
                  - show-message
              sendoptin:
                type:
                  - boolean
                  - "null"
                examples:
                  - true
                  - false
              optin_id:
                type:
                  - integer
                  - "null"
                examples:
                  - 1
              optin_created:
                type: boolean
                default: true
                examples:
                  - true
                  - false
              confform:
                type:
                  - string
                  - "null"
                examples:
                  - "2"
          cfields:
            type: array
            items:
              type: object
              properties:
                type:
                  type:
                    - string
                    - "null"
                  examples:
                    - header
                header:
                  type:
                    - string
                    - "null"
                  examples:
                    - Subscribe for Email Updates
                class:
                  type:
                    - string
                    - "null"
                  examples:
                    - _x41699710
          parentformid:
            type:
              - string
              - "null"
            examples:
              - "0"
          userid:
            type:
              - string
              - "null"
            examples:
              - "1"
          addressid:
            type:
              - string
              - "null"
            examples:
              - "0"
          cdate:
            type:
              - string
              - "null"
            examples:
              - "2018-08-17T13:47:31-05:00"
          udate:
            type:
              - string
              - "null"
            examples:
              - "2018-08-17T13:47:38-05:00"
          entries:
            type:
              - string
              - "null"
            examples:
              - "0"
          aid:
            type:
              - string
              - "null"
            default: "0"
            examples:
              - "0"
          defaultscreenshot:
            type:
              - string
              - "null"
            default: https://img-us1.com/default-form.gif
            examples:
              - https://img-us1.com/default-form.gif
          recent:
            type: array
          contacts:
            type: integer
            default: 0
            examples:
              - 0
          deals:
            type: integer
            default: 0
            examples:
              - 0
          links:
            type: object
            properties:
              address:
                type:
                  - string
                  - "null"
                default: https://:account.api-us1.com/api/3/forms/1/address
                examples:
                  - https://:account.api-us1.com/api/3/forms/1/address
          id:
            type: string
            default: "1"
            examples:
              - "1"
          address:
            type:
              - string
              - "null"
        required:
          - id
streams:
  - "#/definitions/campaigns_stream"
  - "#/definitions/contacts_stream"
  - "#/definitions/lists_stream"
  - "#/definitions/deals_stream"
  - "#/definitions/segments_stream"
  - "#/definitions/forms_stream"

check:
  stream_names: ["campaigns"]
spec:
  type: Spec
  connection_specification:
    $schema: http://json-schema.org/draft-07/schema#
    title: Activecampaign Spec
    type: object
    required:
      - api_key
      - account_username
    additionalProperties: true
    properties:
      api_key:
        type: string
        description: API Key
        airbyte_secret: true
      account_username:
        type: string
        description: Account Username
  documentation_url: https://docs.airbyte.com/integrations/sources/activecampaign
